<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<style type="text/css">
	*{
		font-family: monospace;
	}
	p{
		margin:0;
	}
</style>
<title>MMO | SocketMMO</title>
</head>
<body>

	socketDebugger
	<div id="debug"></div>

</body>

</html>



<script type="text/javascript">
//-------------------------------------------------------------
//define
//-------------------------------------------------------------
	var HOST =  location.origin.replace(/^http/, 'ws');

//-------------------------------------------------------------
//class
//-------------------------------------------------------------
	function getByteLength(str){
  		str = (str==null)?"":str;
  		return encodeURI(str).replace(/%../g, "*").length;
	}
	class Debug {
		static setTarget(target){
			this.target = target;
		}
		static log(log,color = "#000000"){
			if(this.target === undefined || this.target === null){
				this.target = document.body;
			}
			this.target.innerHTML +='<p style = " color: '+ color +' ">' + log + '</p>';
		}

	}
	class MatchingClient extends WebSocket{
		constructor(address){
			super(address);
			Debug.log("web socket server address : " + address);
			this.address = address;
			//es6対応
			//this.
		}
		static test(){

		}
		reqConnect(){
			Debug.log("request connect");
			if(this.address === null){
				return;
			}
			this.onopen = this.onOpen;
			this.onmessage = this.onMessage;
			this.onerror = this.onError;
			Debug.log("connecting...");
		}
		onOpen(event){
			var req = {};
			req.name = "test";

			this.sendJSON('connect',req);
			console.log(event);
			Debug.log("connect.","#FF8C00");
		}
		onMessage(event){
			var res = JSON.parse(event.data);

			console.log(event);
            Debug.log("message : " + event.data + " size :" + getByteLength(event.data) + "byte");
		}
		onError(event){
			Debug.log("error");
		}
		sendJSON(type,data){
			var obj = {};
			obj.type = type;
			obj.data = data;
			var message = JSON.stringify(obj);
			this.send(message);
			Debug.log("send : " + message);
		}

	}
//-------------------------------------------------------------
//entry
//-------------------------------------------------------------
 	Debug.setTarget(document.getElementById("debug"));
	Debug.log("request connect b");
window.onload = function() {
 
    // 実行したい処理を書く

	var mc = new MatchingClient(HOST);
	Debug.log(JSON.stringify(mc));
	Debug.log(mc.test);
}
	

</script>
