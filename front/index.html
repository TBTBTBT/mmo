<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<style type="text/css">
	*{
		font-family: monospace;
	}
	p{
		margin:0;
	}
</style>
<title>MMO | SocketMMO</title>
</head>
<body>

	socketDebugger
	<div id="debug"></div>

</body>

</html>



<script type="text/javascript">
//-------------------------------------------------------------
//define
//-------------------------------------------------------------
	var HOST =  location.origin.replace(/^http/, 'ws');

//-------------------------------------------------------------
//class
//-------------------------------------------------------------
	function getByteLength(str){
  		str = (str==null)?"":str;
  		return encodeURI(str).replace(/%../g, "*").length;
	}
	class Debug {
		static setTarget(target){
			this.target = target;
		}
		static log(log,color = "#000000"){
			if(this.target === undefined || this.target === null){
				this.target = document.body;
			}
			this.target.innerHTML +='<p style = " color: '+ color +' ">' + log + '</p>';
		}

	}
	class MatchingClient extends WebSocket{
		constructor(data){
			super(data);
		}
		initialize(address){
			Debug.log("web socket server address : " + address);
			this.address = address;
		}
		reqConnect(){
			Debug.log("request connect");
			if(this.address === null){
				return;
			}
			this.ws = new WebSocket(this.address);
			this.ws.onopen = this.onOpen;
			this.ws.onmessage = this.onMessage;
			this.ws.onerror = this.onError;
			Debug.log("connecting...");
		}
		onOpen(event){
			var req = {};
			req.id = "test";

			this.sendJSON('connect',req);
			console.log(event);
			Debug.log("connect.","#FF8C00");
		}
		onMessage(event){
			var res = JSON.parse(event.data);

			console.log(event);
            Debug.log("message : " + event.data + " size :" + getByteLength(event.data) + "byte");
		}
		onError(event){
			Debug.log("error");
		}
		sendJSON(type,data){
			var format = this.format(type,data);
			var message = JSON.stringify(format);
			this.ws.send(message);
			Debug.log("send : " + message);
		}
		format(type,data){
			var obj = {};
			obj.type = type;
			obj.data = data;
			console.log(obj);
			return obj;
		}

	}
//-------------------------------------------------------------
//entry
//-------------------------------------------------------------

	Debug.setTarget(document.getElementById("debug"));
	console.log("test");
	var mc = new MatchingClient();
	mc.initialize(HOST);
	mc.reqConnect();

</script>
